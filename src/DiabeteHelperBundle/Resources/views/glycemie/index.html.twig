{% extends 'DiabeteHelperBundle::layout.html.twig' %}

{% block title %}
    Glycémies {{ parent() }}
{% endblock title %}

{% block breadcrumb %}
    {{ parent() }}
    <li><a href="{{ path('glycemie_index') }}">Glycémies</a></li>
{% endblock breadcrumb %}


{% block body %}


    <a class="btn btn-success" href="{{ path('glycemie_new') }}">Ajouter une nouvelle glycémie</a>

    <h1>Liste des glycémies</h1>

    <table class="table table-striped">
        <thead>
        <tr>
            <th>Date/heure de<br/>la glycemie</th>
            <th>Taux de la<br/>glycemie</th>
            <th>Taux acetone</th>
            <th>Temps par rapport<br/> au repas</th>
            <th>Activité physique</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for glycemie in glycemies %}
            <tr>
                <td>{% if glycemie.dateGlycemie %}{{ glycemie.dateGlycemie|date('H:i') }}
                        <br/>{{ glycemie.dateGlycemie|date('d/M/y') }}{% endif %}</td>
                {% if glycemie.tauxGlycemie >= 1.80 or glycemie.tauxGlycemie <= 0.70 %}
                    <td><b>{{ glycemie.tauxGlycemie }} g/L</b></td>
                {% else %}
                    <td>{{ glycemie.tauxGlycemie }} g/L</td>
                {% endif %}
                <td>{{ glycemie.tauxAcetone }}</td>
                <td>{{ glycemie.repas }}</td>
                <td>{{ glycemie.activite|capitalize }}</td>
                <td class="btn-group-vertical" role="group" aria-label="...">
                    {#<a class="btn btn-default" href="{{ path('glycemie_show', { 'idGlycemie': glycemie.idGlycemie }) }}">Afficher</a>#}
                    <button type="button" class="btn btn-default" id="{{ glycemie.idGlycemie }}"
                            onclick="showGlycemieModal(id)" data-toggle="modal" data-target="#showGlycemie"
                            data-dateGlycemie="{{ glycemie.dateGlycemie|date('d/M/Y H:i') }}"
                            data-tauxGlycemie="{{ glycemie.tauxGlycemie }}"
                            data-tauxAcetone="{{ glycemie.tauxAcetone }}"
                            data-repas="{{ glycemie.repas }}"
                            data-activite="{{ glycemie.activite }}"
                            data-remarque="{{ glycemie.remarque }}"
                    >Afficher
                    </button>
                    <a class="btn btn-default" href="{{ path('glycemie_edit', { 'idGlycemie': glycemie.idGlycemie }) }}">Modifier</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>





{% endblock body %}

{% block footer %}
    {#Modal boostrap#}

    <!-- Modal -->
    <div class="modal fade" id="showGlycemie" tabindex="-1" role="dialog" aria-labelledby="showGlycemie">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header" id="showGlycemieHeader">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="showGlycemieTitle" style="text-align: center">Erreur</h4>
                </div>
                <div class="modal-body" id="showGlycemieBody">
                </div>
                <div class="modal-footer" id="showGlycemieFooter">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>
    {#Modal boostrap end#}

    <script>
        function showGlycemieModal(id) {
            var glycemie = document.getElementById(id);

            var dateGlycemie = glycemie.dataset.dateglycemie;
            var tauxGlycemie = glycemie.dataset.tauxglycemie;
            var tauxAcetone = glycemie.dataset.tauxacetone;
            var repas = glycemie.dataset.repas;
            var activite = glycemie.dataset.activite;
            var remarque = glycemie.dataset.remarque;

            if (tauxGlycemie != '') {
                tauxGlycemie = tauxGlycemie + ' g/L'
            }
            if (tauxAcetone != '') {
                tauxAcetone = 'Taux d\'acétone : ' + tauxAcetone + ' g/L'
            }
            if (repas != '') {
                repas = '<br/>Moment de la glycémie par rapport au repas : ' + repas
            }
            if (activite) {
                activite = '<br/>Activité physique avant / après glycémie : ' + activite
            }
            if (remarque) {
                remarque = '<br/>Remarque : ' + remarque
            }

            document.getElementById('showGlycemieTitle').innerHTML = 'Glycémie du ' + dateGlycemie;
            document.getElementById('showGlycemieBody').innerHTML = '<p> Taux de la glycémie : ' + tauxGlycemie +
                    '<br/>' + tauxAcetone +
                    '<br/>' + repas +
                    activite +
                    '<br/>' + remarque + '</p>';
            //document.getElementById('showGlycemieFooter').innerHTML += '<button type="button" class="btn btn-primary">Save changes</button>';
        }
    </script>
{% endblock footer %}
